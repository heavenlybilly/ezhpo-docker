DOCKER_COMPOSE = docker-compose -f docker-compose.yml

build:
	$(DOCKER_COMPOSE) build --no-cache

down:
	$(DOCKER_COMPOSE) down

up:
	$(DOCKER_COMPOSE) up -d

restart:
	$(DOCKER_COMPOSE) restart

bash:
	$(DOCKER_COMPOSE) exec -it php-apache bash

db:
	$(DOCKER_COMPOSE) exec -it db bash

enable:
	@read -p "Enter host name: " HOST_NAME && \
	$(DOCKER_COMPOSE) exec -T php-apache a2ensite $$HOST_NAME && \
	$(DOCKER_COMPOSE) exec -T php-apache service apache2 reload

import-db:
	@read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…: " DB_NAME && \
	echo "âš ï¸  Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ: ÐµÑÐ»Ð¸ Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… '$$DB_NAME' ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ â€” Ð¾Ð½Ð° Ð±ÑƒÐ´ÐµÑ‚ ÑƒÐ´Ð°Ð»ÐµÐ½Ð° Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ð·Ð°Ð½Ð¾Ð²Ð¾!" && \
	read -p "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ? (Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð»ÑŽÐ±ÑƒÑŽ ÐºÐ»Ð°Ð²Ð¸ÑˆÑƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ, 'n' â€” Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ): " CONFIRM && \
	read -e -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿ÑƒÑ‚ÑŒ Ðº SQL-Ð´Ð°Ð¼Ð¿Ñƒ (Ð½Ð° Ñ…Ð¾ÑÑ‚Ðµ): " && \
	gunzip -c $$REPLY > dump.sql && \
	$(DOCKER_COMPOSE) cp .env db:/tmp/.env && \
	$(DOCKER_COMPOSE) cp pre.sh db:/tmp/pre.sh && \
	$(DOCKER_COMPOSE) cp post.sh db:/tmp/post.sh && \
	$(DOCKER_COMPOSE) exec -T db chmod +x /tmp/pre.sh && \
	$(DOCKER_COMPOSE) exec -T db chmod +x /tmp/post.sh && \
	$(DOCKER_COMPOSE) exec -T -w /tmp db bash -c "./pre.sh $$DB_NAME" && \
	echo "ðŸ”µ Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð‘Ð” Ð¸Ð· Ð´Ð°Ð¼Ð¿Ð°" && \
	pv dump.sql | $(DOCKER_COMPOSE) exec -T db mysql -u root -proot $$DB_NAME && \
	$(DOCKER_COMPOSE) exec -T -w /tmp db bash -c "./post.sh $$DB_NAME"